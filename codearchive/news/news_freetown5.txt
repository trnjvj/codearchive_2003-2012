<?

set_time_limit (600000);

$Host = "localhost";
$User = "root";
$Password = "";
$DBName = "world";
$Tablename = "T1";
$Link = mysql_connect ($Host, $User, $Password) or die ("Cannot connect to the database.\n");
mysql_select_db ("$Tablename");


$Query = "SELECT b from freetown_categories;";
$Result = mysql_db_query($DBName, $Query, $Link);
while ($Row = mysql_fetch_array ($Result))
	{
    $mSearch = $Row[0];
	


$mSearch2=str_replace(" ", "+", $mSearch);
print "<font face=verdana size=1><b>\n\r\n\r";

for ($o=0; $o<500; $o=$o+10) {
$TheFile = "http://news.google.com/news?q=$mSearch2&hl=en&lr=&ie=UTF-8&safe=off&edition=&start=$o&sa=N";
$Open = fopen($TheFile, "r");
if ($Open) {
	$Data = file($TheFile);
	for ($n = 0; $n < count($Data); $n++) {
		$String = trim($Data[$n]);
		$Array = explode("<p>", $String);
		for ($m = 0; $m < count($Array); $m++) {
		$SS2 = strstr($Array[$m], 'content-type');
		$SS3 = strstr($Array[$m], 'Google');
		
			$SS1 = stristr($Array[$m], 'http');
			$SS1 = str_replace("<b>", "", $SS1);
			$SS1 = str_replace("</b>", "", $SS1);
			$SS1 = str_replace("</a>", "|1", $SS1);
			$SS1 = str_replace("<br>", "|2", $SS1);
			$SS1 = str_replace("<font size=-1>", "|3", $SS1);
			$SS1 = str_replace("<font color=green>", "|4", $SS1);
			$SS1 = str_replace("&nbsp;", " ", $SS1);
			$SS1 = str_replace("</font>", "|6", $SS1);
			$SS1 = str_replace("<font size=-1>", "|7", $SS1);
			$SS1 = str_replace("<font size=-1 color=#6f6f6f>", "|8", $SS1);
			$SS1 = str_replace(">", "|9", $SS1);
			$SS1 = str_replace("<a href=", "|0", $SS1);
			$SS1 = str_replace("|", "<br>|", $SS1);
			$SS1 = str_replace("|9", "|TITLE=", $SS1);
			$SS1 = str_replace("|4", "|SOURCE=", $SS1);
			$SS1 = str_replace("http", "|URL=http", $SS1);
			$SS1 = str_replace("|8", "|SOURCE=", $SS1);
			$SS1 = str_replace("|6 - ", "|TIME=", $SS1);
			$SS1 = str_replace("|3", "|STORY=", $SS1);
			$SS1 = str_replace("|STORY=<br>", "", $SS1);
			$SS1 = str_replace("|0|", "", $SS1);
			$SS1 = str_replace("|1<br>", "", $SS1);
			$SS1 = str_replace("|2<br>", "", $SS1);
			$SS1 = str_replace("|6<br>", "", $SS1);
			$SS1 = str_replace("|1 - <br>", "", $SS1);
			$SS1 = str_replace("|2", "<hr>\n\r", $SS1);
			$SS1 = str_replace("       <br>", "|", $SS1);
			$SS1 = str_replace("<br><hr>", "", $SS1);
			$SS1 = str_replace("<br>", "", $SS1);
			
			
			
			if ($SS1) {
					if ($SS2) {} else {
					if ($SS3) {} else {
					
					
					$Array2 = explode("|", $SS1);
					for ($mm = 0; $mm < count($Array2); $mm++) {
						$SSS = $Array2[$mm];
						
						$T1 = strstr($SSS, "URL=");
						$URL=str_replace("URL=", "", $URL);
						
						if ($T1) {$URL=$SSS;}
						$T1 = strstr($SSS, "SOURCE=");
						$SOURCE=str_replace("SOURCE=", "", $SOURCE);
						
						if ($T1) {$SOURCE=$SSS;}
						$T1 = strstr($SSS, "TITLE=");
						$TITLE=str_replace("TITLE=", "", $TITLE);
						
						if ($T1) {$TITLE=$SSS;}
						$T1 = strstr($SSS, "TIME=");
						$TIME=str_replace("TIME=", "", $TIME);
						
						if ($T1) {$TIME=$SSS;}
						$T1 = strstr($SSS, "STORY=");
						if ($T1) {$STORY=$SSS;
						$STORY=str_replace("STORY=", "", $STORY);
						}
						
						}
						$LAND="";
						
						$T1 = strstr($SOURCE, ",");
						if ($T1) {
						
						$Array3 = explode(",", $SOURCE);
						for ($mmm = 0; $mmm < count($Array3); $mmm++) {
						if ($mmm==0) {$SOURCE=$Array3[$mmm];
						$SOURCE=str_replace("SOURCE=", "", $SOURCE);
						}
						if ($mmm==1) {$LAND=trim($Array3[$mmm]);}
						$SSS = $Array3[$mmm];
						}
												
						}
						
						
						$YEAR="";
						
						$T1 = strstr($TIME, ",");
						if ($T1) {
						
						$Array3 = explode(",", $TIME);
						for ($mmm = 0; $mmm < count($Array3); $mmm++) {
						if ($mmm==0) {$TIME=$Array3[$mmm];
						$TIME=str_replace("TIME=", "", $TIME);
						}
						if ($mmm==1) {$YEAR=trim($Array3[$mmm]);}
						$SSS = $Array3[$mmm];
						}
												
						}
						$SOURCE=str_replace("SOURCE=", "", $SOURCE);
						$SOURCE=trim($SOURCE);
						$T1 = strstr($URL, "TITLE=");
						if ($T1) {} else {
						print "$URL|$SOURCE|$LAND|$TITLE|$TIME|$YEAR|$STORY<br>";
						$mThis = "$URL|$SOURCE|$LAND|$TITLE|$TIME|$YEAR|$STORY";
						$Query23="INSERT INTO `freetown_news` ( `SEARCH` , `URL` , `SOURCE` , `LAND` , `TIME` , `YEAR` , `STORY` , `TIMESTAMP` ) VALUES ('$mSearch', '$URL', '$SOURCE', '$LAND', '$TIME', '$YEAR', '$STORY', '$TIMESTAMP');";
						$Result23 = mysql_db_query($DBName, $Query23, $Link);
						}
					}}
					}
}}}
}
}
print "\n\r\n\r\n\r</b></font>";

mysql_close ($Link);
?>
