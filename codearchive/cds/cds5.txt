<?
set_time_limit (600000);
$mSearch="Tim Johnson";
print "<table><tr>";
$Col=1;
$login=1;
$mCached=0;
if ($mCached==0) {
$Cache="";
$mCount2002 = 0;
$Found2000 = 1;
$mCount300=0;
for ($m1 = 1; $m1 < 20; $m1++) {
if ($mCount2002>5 and $login==0) {$Found2000=0;}
if ($Found2000==1) {
$TheFile = "http://www.amazon.com/exec/obidos/external-search?tag=stardigger&mode=Music&keyword=$mSearch&pg=$m1";
$Open = fopen($TheFile, "r");
if ($Open) {
	$Found2000=0;
	$First=1;
	$TFound=0;
	$Data = file($TheFile);
	for ($n = 0; $n < count($Data); $n++) {
		$String = trim($Data[$n]);
		$Array = explode("<p>", $String);
		for ($m = 0; $m < count($Array); $m++) {
			$V0 = strstr($Array[$m], 'http://g-images.amazon.com/images/G/01/search-browse/button-more-results.gif');
			if ($V0) {
				$Found2000=1;
				}
			$V1 = strstr($Array[$m], 'Release Date:');
			if ($V1) {
					$V2 = strpos($Array[$m], ":");
					$V3 = strlen($Array[$m]);
					$V4 = substr($Array[$m], $V2+2, $V3-$V2-2);
					$V8=$V4;
					}
			$V1 = strstr($Array[$m], 'G/01/detail/stars-');
			if ($V1) {
					$V2 = str_replace("<br>", "", $Array[$m]);
					$V2 = strpos($Array[$m], "alt=");
					$V3 = strlen($Array[$m]);
					$V4 = substr($Array[$m], $V2+5, 3);
                    $V9=$V4;
					}
			$S1 = strstr($Array[$m], '<a href=/exec/obidos/tg/detail/-/');
			if ($S1) {
					$S2 = strpos($Array[$m], "-");
					$S3 = strpos($Array[$m], "/", $S2+2);
					$S4 = substr($Array[$m], $S2+2, $S3-$S2-2);
					$T0 = strpos($Array[$m], "<img");
					if ($T0) {
						$T1 = strpos($Array[$m], "glance");
						$T2 = strpos($Array[$m], ">", $T1);
						$T3 = strpos($Array[$m], "<", $T2);
						$T3b = strpos($Array[$m], "<", $T3+1);
						$T4 = substr($Array[$m], $T2+1, $T3b-$T2-1);
						$T5 = "<a target=_blank href=http://www.amazon.com/exec/obidos/ASIN/$S4/ref=ase_holisticopia-20>$T4</a>";
						$Image=$T5;
								$Image = str_replace("THUMB", "LZZZZ", $Image);
								$Image = str_replace("LZZZZ", "THUMB", $Image);
								$Image = str_replace("width=50 height=49 ", "", $Image);
								$Image = str_replace("width=50 height=50 ", "", $Image);
								$Image = str_replace("align=left ", "", $Image);
                                $Image = str_replace("<img ", "<img ", $Image);
						$T6 = strpos($Image, "music-no-image.gif");
						if ($T6) {
							$Image = "";
							}
						} else {
						$T1 = strpos($Array[$m], "glance");
						$T2 = strpos($Array[$m], ">", $T1);
						$T3 = strpos($Array[$m], "<", $T2);
						$T4 = substr($Array[$m], $T2+1, $T3-$T2-1);
						$Story = "<a target=_blank href=http://www.amazon.com/exec/obidos/ASIN/$S4/ref=ase_holisticopia-20>$T4</a>";
						if ($First==0) {
                        	$mThis = strpos($Story, "Buy");
                            if ($mThis) {} else {
                            $mHasImage = strpos($Image, "img");
                            if ($mHasImage) {
                            $mCount2002 = $mCount2002+1;
                            if ($login==1 or $mCount2002<4) {
                    		print "<td>";
							print "Image=$Image<br>\n";
							print "Story=$Story<br>\n";
                            print "</td>";
							$Col++;
							if ($Col>3) {
							$Col=1;
							print "</tr><tr>";
							}
                            $mCount300=$mCount300+1;
                            if ($mCount300>0) {
                            	print "";
                                $mCount300=0;
                                }
                            }
                           	}
                            }
							$TFound=1;
							}
							else {
							$First=0;
							}
						}
					$Sound = $S4;
					$Found=1;
					$mStory = str_replace("<a href=/exec/", "<a href=http://www.amazon.com/exec/", $Array[$m]);
					$mStory = str_replace(" align=left", "", $mStory);
					$S5 = strstr($mStory, "<img");
					if ($TFound==1) {
					}
				}
			}
		}
	}
}
}
}
print "</tr></table>";
?>
